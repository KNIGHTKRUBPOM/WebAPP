<!DOCTYPE html>
<html>
    <head></head>
    <body>
        <div id="maincontainer"></div>
        <script>
            const container = document.getElementById('maincontainer');
            // Title
            const title = document.createElement('h1');
            title.textContent = "Exercise 14: JavaScript&DOM";
            container.appendChild(title);

            // ปุ่มเริ่มต้น
            let startButton = document.createElement('button');
            startButton.textContent = "Click me to display Date and Time";
            container.appendChild(startButton);

            // ปุ่มแสดงเวลา
            let timeButton = document.createElement('button');
            timeButton.style.display = "none";
            container.appendChild(timeButton);

            // ตัวเก็บสีล่าสุด
            let lastBgColor = "#000000";
            let lastTextColor = "#FFFFFF";

            // Web Worker
            const worker = new Worker('web_worker.js');
            let running = false;

            worker.onmessage = (e) => {
                if (e.data.reset) {
                    // สร้างปุ่มใหม่ใต้ h1 แสดงวัน/เวลา
                    timeButton.style.display = "inline";
                    timeButton.style.position = "static";
                    timeButton.style.margin = "5px 0";
                    timeButton.textContent = new Date().toString();
                    timeButton.style.backgroundColor = lastBgColor;
                    timeButton.style.color = lastTextColor;

                    // เพิ่ม event ให้กดแล้วเด้งไปมุมขวาบนได้
                    timeButton.onclick = togglePosition;
                } else {
                    timeButton.textContent = e.data.timeString;
                    timeButton.style.backgroundColor = e.data.bgColor;
                    timeButton.style.color = e.data.textColor;

                    lastBgColor = e.data.bgColor;
                    lastTextColor = e.data.textColor;
                }
            };

            function toggleTime() {
                if (!running) {
                    startButton.style.display = "none";
                    timeButton.style.display = "inline";

                    // ย้ายปุ่มไปมุมขวาบน
                    timeButton.style.position = "fixed";
                    timeButton.style.top = "0px";
                    timeButton.style.right = "0px";
                    timeButton.style.margin = "0";
                    timeButton.style.borderRadius = "0";
                    timeButton.style.padding = "5px 10px";

                    worker.postMessage({ command: 'start' });

                    // --- อัปเดตครั้งแรก (แก้ตรงนี้ให้ขึ้นทันที + สีแดง) ---
                    // --- อัปเดตครั้งแรก (แก้ตรงนี้ให้ขึ้นทันที + สีแดง) ---
                    const now = new Date();
                    timeButton.textContent = now.toString();
                    
                } else {
                    worker.postMessage({ command: 'stop' });
                }
                running = !running;
            }

            startButton.addEventListener('click', toggleTime);
            timeButton.addEventListener('click', toggleTime);

            // --- ฟังก์ชันสลับตำแหน่งปุ่มหลัง stop ---
            let atTopRight = false;

            function togglePosition() {
                if (!atTopRight) {
                    // เด้งไปมุมขวาบน
                    timeButton.style.position = "fixed";
                    timeButton.style.top = "0px";
                    timeButton.style.right = "0px";
                    timeButton.style.margin = "0";
                    timeButton.style.borderRadius = "0";
                    timeButton.style.padding = "5px 10px";
                    atTopRight = true;
                } else {
                    // กลับใต้ h1
                    timeButton.style.position = "static";
                    timeButton.style.margin = "5px 0";
                    timeButton.style.borderRadius = "";
                    timeButton.style.padding = "";
                    atTopRight = false;
                }
            }
            
        </script>
    </body>
</html>
